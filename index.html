                    action: editMode ? 'update' : 'add'
                };

                // Convertir el objeto a FormData para enviarlo a Google Apps Script
                const scriptData = new FormData();
                for (const key in project) {
                    scriptData.append(key, project[key]);
                }

                try {
                    const response = await fetch(SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors', // Esencial para evitar errores de CORS con Google Scripts
                        body: scriptData
                    });

                    // Con 'no-cors', no podemos leer la respuesta, pero podemos asumir éxito si no hay error.
                    alert(editMode ? 'Proyecto actualizado exitosamente.' : 'Proyecto guardado exitosamente.');
                    
                    // Actualizar la tabla localmente
                    if (editMode) {
                        updateProjectLocal(project);
                    } else {
                        // Para 'add', el ID real lo genera el backend. Recargamos para obtenerlo.
                        addProjectLocal(project); // Añade localmente para feedback inmediato
                        loadProjects(); // Recarga para sincronizar con el backend
                    }
                    resetForm();

                } catch (error) {
                    console.error('Error:', error);
                    alert('Error al guardar. Revisa la consola para más detalles.');
                }
            });

            // Función para cargar proyectos desde el backend
            async function loadProjects() {
                if (!SCRIPT_URL) return; // No hacer nada si la URL no está definida
                try {
                    const response = await fetch(SCRIPT_URL); // GET por defecto
                    const result = await response.json();
            // Eliminar (llama al backend y refresca)
            window.deleteProject = async (id) => {
                if (!confirm('¿Estás seguro de eliminar este proyecto?')) return;

                const scriptData = new FormData();
                scriptData.append('id', id);
                scriptData.append('action', 'delete');

                try {
                    const response = await fetch(SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        body: scriptData
                    });

                    alert('Proyecto eliminado exitosamente.');

                    // Eliminar localmente y refrescar la tabla
                    projects = projects.filter(p => p.id != id);
                    saveToLocalStorage(projects);
                    refreshTable();

                } catch (error) {
                    console.error('Error eliminando:', error);
                    alert('Error al eliminar.');
                }
            };

            // Editar

