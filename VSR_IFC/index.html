<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="./vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VSR IFC Viewer</title>
    <!-- CRITICAL: Error handler MUST be before module scripts -->
    <script>
      window.logToScreen = function(msg, isError) {
         const consoleDiv = document.getElementById('debug-console');
         if (consoleDiv) {
           const div = document.createElement('div');
           div.textContent = `[InitLog] ${msg}`;
           if (isError) div.style.color = 'red';
           consoleDiv.appendChild(div);
         }
      };

      window.onerror = function(msg, url, lineNo, columnNo, error) {
        const consoleDiv = document.getElementById('debug-console');
        if (consoleDiv) {
          const div = document.createElement('div');
          div.style.color = 'red';
          div.textContent = `[Global Error] ${msg} at ${url}:${lineNo}:${columnNo}`;
          consoleDiv.appendChild(div);
          if (error && error.stack) {
             const stackDiv = document.createElement('div');
             stackDiv.style.color = '#ffaaaa';
             stackDiv.style.whiteSpace = 'pre-wrap';
             stackDiv.textContent = error.stack;
             consoleDiv.appendChild(stackDiv);
          }
        }
        return false;
      };
      
      window.addEventListener('unhandledrejection', function(event) {
        const consoleDiv = document.getElementById('debug-console');
        if (consoleDiv) {
          const div = document.createElement('div');
          div.style.color = 'orange';
          div.textContent = `[Unhandled Promise] ${event.reason}`;
          consoleDiv.appendChild(div);
        }
      });

      // Capture resource loading errors (like 404 scripts)
      window.addEventListener('error', function(event) {
          if (event.target && (event.target.tagName === 'SCRIPT' || event.target.tagName === 'LINK')) {
              const consoleDiv = document.getElementById('debug-console');
              if (consoleDiv) {
                  const div = document.createElement('div');
                  div.style.color = 'magenta';
                  div.textContent = `[Resource Error] Failed to load: ${event.target.src || event.target.href}`;
                  consoleDiv.appendChild(div);
              }
          }
      }, true);
    </script>
    <script type="module" src="/src/main.ts"></script>
  </head>
  <body>
    <div id="app">
      <div id="debug-console" style="position: fixed; bottom: 0; left: 0; width: 100%; height: 150px; background: rgba(0,0,0,0.8); color: lime; font-family: monospace; overflow-y: auto; z-index: 9999; padding: 10px; font-size: 12px; pointer-events: none;">
        <div>Debug Console Ready (v3)...</div>
      </div>
      <!-- Error handler script moved to head -->
      <div class="ui-container">
        <select id="model-select">
          <option value="" disabled selected>Select a model</option>
        </select>
        <input type="file" id="file-input" accept=".ifc">
        <label for="file-input" class="file-label">Upload IFC</label>
      </div>
      <div id="viewer-container"></div>
    </div>
  </body>
</html>
